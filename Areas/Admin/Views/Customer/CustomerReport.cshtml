@{
    ViewBag.Title = "Customer Reports";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="container-fluid py-4">
    <!-- Report Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header pb-0">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <h5 class="mb-0">Customer Reports & Analytics</h5>
                            <p class="text-sm mb-0">Generate and view detailed customer reports</p>
                        </div>
                        <button class="btn bg-gradient-primary" data-bs-toggle="modal" data-bs-target="#generateReportModal">
                            <i class="material-symbols-rounded">add</i>&nbsp; Generate New Report
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="input-group input-group-outline">
                                <label class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="startDate">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="input-group input-group-outline">
                                <label class="form-label">End Date</label>
                                <input type="date" class="form-control" id="endDate">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="reportType">
                                <option value="">Select Report Type</option>
                                <option value="overview">Customer Overview</option>
                                <option value="behavior">Customer Behavior</option>
                                <option value="revenue">Revenue Analysis</option>
                                <option value="retention">Retention Report</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button class="btn bg-gradient-info w-100" onclick="generateReport()">
                                <i class="material-symbols-rounded">search</i> Apply Filters
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Metrics Row -->
    <div class="row mb-4">
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
            <div class="card">
                <div class="card-header p-2 ps-3">
                    <div class="d-flex justify-content-between">
                        <div>
                            <p class="text-sm mb-0 text-capitalize">Total Customers</p>
                            <h4 class="mb-0">2,284</h4>
                        </div>
                        <div class="icon icon-md icon-shape bg-gradient-dark shadow-dark text-center border-radius-md">
                            <i class="material-symbols-rounded opacity-10">group</i>
                        </div>
                    </div>
                    <span class="text-success text-sm font-weight-bolder">+15%</span>
                    <span class="text-sm">than last month</span>
                </div>
                <hr class="dark horizontal my-0">
                <div class="card-footer p-2 ps-3">
                    <p class="mb-0 text-sm">
                        <span class="text-success font-weight-bolder">+124 </span>new customers
                    </p>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
            <div class="card">
                <div class="card-header p-2 ps-3">
                    <div class="d-flex justify-content-between">
                        <div>
                            <p class="text-sm mb-0 text-capitalize">Active Customers</p>
                            <h4 class="mb-0">1,856</h4>
                        </div>
                        <div class="icon icon-md icon-shape bg-gradient-success shadow-success text-center border-radius-md">
                            <i class="material-symbols-rounded opacity-10">person</i>
                        </div>
                    </div>
                    <span class="text-success text-sm font-weight-bolder">+8%</span>
                    <span class="text-sm">than last month</span>
                </div>
                <hr class="dark horizontal my-0">
                <div class="card-footer p-2 ps-3">
                    <p class="mb-0 text-sm">
                        <span class="text-success font-weight-bolder">81% </span>activity rate
                    </p>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
            <div class="card">
                <div class="card-header p-2 ps-3">
                    <div class="d-flex justify-content-between">
                        <div>
                            <p class="text-sm mb-0 text-capitalize">Avg. Bookings</p>
                            <h4 class="mb-0">8.7</h4>
                        </div>
                        <div class="icon icon-md icon-shape bg-gradient-info shadow-info text-center border-radius-md">
                            <i class="material-symbols-rounded opacity-10">hotel</i>
                        </div>
                    </div>
                    <span class="text-success text-sm font-weight-bolder">+3%</span>
                    <span class="text-sm">than last month</span>
                </div>
                <hr class="dark horizontal my-0">
                <div class="card-footer p-2 ps-3">
                    <p class="mb-0 text-sm">
                        <span class="text-success font-weight-bolder">Per customer</span>
                    </p>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
            <div class="card">
                <div class="card-header p-2 ps-3">
                    <div class="d-flex justify-content-between">
                        <div>
                            <p class="text-sm mb-0 text-capitalize">Customer LTV</p>
                            <h4 class="mb-0">$12,450</h4>
                        </div>
                        <div class="icon icon-md icon-shape bg-gradient-warning shadow-warning text-center border-radius-md">
                            <i class="material-symbols-rounded opacity-10">payments</i>
                        </div>
                    </div>
                    <span class="text-success text-sm font-weight-bolder">+12%</span>
                    <span class="text-sm">than last month</span>
                </div>
                <hr class="dark horizontal my-0">
                <div class="card-footer p-2 ps-3">
                    <p class="mb-0 text-sm">
                        <span class="text-success font-weight-bolder">Lifetime value</span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row mb-4">
        <div class="col-lg-8 mb-4">
            <div class="card">
                <div class="card-header pb-0">
                    <div class="d-flex align-items-center justify-content-between">
                        <h6>Customer Growth Trend</h6>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-secondary active">Week</button>
                            <button type="button" class="btn btn-outline-secondary">Month</button>
                            <button type="button" class="btn btn-outline-secondary">Year</button>
                        </div>
                    </div>
                </div>
                <div class="card-body p-3">
                    <div class="chart">
                        <canvas id="customerGrowthChart" class="chart-canvas" height="300"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4 mb-4">
            <div class="card">
                <div class="card-header pb-0">
                    <h6>Customer Retention Rate</h6>
                </div>
                <div class="card-body p-3">
                    <div class="chart">
                        <canvas id="retentionChart" class="chart-canvas" height="300"></canvas>
                    </div>
                    <div class="mt-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-sm">Monthly Retention</span>
                            <span class="text-sm font-weight-bold">87%</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-sm">Yearly Retention</span>
                            <span class="text-sm font-weight-bold">65%</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="text-sm">Churn Rate</span>
                            <span class="text-sm font-weight-bold text-danger">13%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Saved Reports -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header pb-0">
                    <h6>Saved Reports</h6>
                </div>
                <div class="card-body px-0 pt-0 pb-2">
                    <div class="table-responsive p-0">
                        <table class="table align-items-center mb-0">
                            <thead>
                                <tr>
                                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Report Name</th>
                                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Type</th>
                                    <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Date Range</th>
                                    <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Generated</th>
                                    <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Status</th>
                                    <th class="text-secondary opacity-7"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <div class="d-flex px-2 py-1">
                                            <div class="icon icon-shape icon-sm bg-gradient-primary shadow text-center me-2 d-flex align-items-center justify-content-center">
                                                <i class="material-symbols-rounded text-white opacity-10">description</i>
                                            </div>
                                            <div class="d-flex flex-column justify-content-center">
                                                <h6 class="mb-0 text-sm">Q4 Customer Overview 2024</h6>
                                                <p class="text-xs text-secondary mb-0">Comprehensive analysis</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge badge-sm bg-gradient-info">Overview</span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <span class="text-secondary text-xs">Oct 1 - Dec 31, 2024</span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <span class="text-secondary text-xs">Jan 5, 2025</span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <span class="badge badge-sm bg-gradient-success">Complete</span>
                                    </td>
                                    <td class="align-middle">
                                        <button class="btn btn-link text-secondary mb-0" onclick="viewReport()">
                                            <i class="material-symbols-rounded text-sm">visibility</i>
                                        </button>
                                        <button class="btn btn-link text-secondary mb-0" onclick="downloadReport()">
                                            <i class="material-symbols-rounded text-sm">download</i>
                                        </button>
                                        <button class="btn btn-link text-secondary mb-0" onclick="shareReport()">
                                            <i class="material-symbols-rounded text-sm">share</i>
                                        </button>
                                        <button class="btn btn-link text-secondary mb-0" onclick="deleteReport()">
                                            <i class="material-symbols-rounded text-sm">delete</i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="d-flex px-2 py-1">
                                            <div class="icon icon-shape icon-sm bg-gradient-success shadow text-center me-2 d-flex align-items-center justify-content-center">
                                                <i class="material-symbols-rounded text-white opacity-10">description</i>
                                            </div>
                                            <div class="d-flex flex-column justify-content-center">
                                                <h6 class="mb-0 text-sm">Customer Behavior Analysis</h6>
                                                <p class="text-xs text-secondary mb-0">Booking patterns & preferences</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge badge-sm bg-gradient-warning">Behavior</span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <span class="text-secondary text-xs">Sep 1 - Dec 31, 2024</span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <span class="text-secondary text-xs">Dec 28, 2024</span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <span class="badge badge-sm bg-gradient-success">Complete</span>
                                    </td>
                                    <td class="align-middle">
                                        <button class="btn btn-link text-secondary mb-0" onclick="viewReport()">
                                            <i class="material-symbols-rounded text-sm">visibility</i>
                                        </button>
                                        <button class="btn btn-link text-secondary mb-0" onclick="downloadReport()">
                                            <i class="material-symbols-rounded text-sm">download</i>
                                        </button>
                                        <button class="btn btn-link text-secondary mb-0" onclick="shareReport()">
                                            <i class="material-symbols-rounded text-sm">share</i>
                                        </button>
                                        <button class="btn btn-link text-secondary mb-0" onclick="deleteReport()">
                                            <i class="material-symbols-rounded text-sm">delete</i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="d-flex px-2 py-1">
                                            <div class="icon icon-shape icon-sm bg-gradient-info shadow text-center me-2 d-flex align-items-center justify-content-center">
                                                <i class="material-symbols-rounded text-white opacity-10">description</i>
                                            </div>
                                            <div class="d-flex flex-column justify-content-center">
                                                <h6 class="mb-0 text-sm">Revenue by Customer Segment</h6>
                                                <p class="text-xs text-secondary mb-0">Financial performance</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge badge-sm bg-gradient-success">Revenue</span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <span class="text-secondary text-xs">Jan 1 - Dec 31, 2024</span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <span class="text-secondary text-xs">Jan 2, 2025</span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <span class="badge badge-sm bg-gradient-success">Complete</span>
                                    </td>
                                    <td class="align-middle">
                                        <button class="btn btn-link text-secondary mb-0" onclick="viewReport()">
                                            <i class="material-symbols-rounded text-sm">visibility</i>
                                        </button>
                                        <button class="btn btn-link text-secondary mb-0" onclick="downloadReport()">
                                            <i class="material-symbols-rounded text-sm">download</i>
                                        </button>
                                        <button class="btn btn-link text-secondary mb-0" onclick="shareReport()">
                                            <i class="material-symbols-rounded text-sm">share</i>
                                        </button>
                                        <button class="btn btn-link text-secondary mb-0" onclick="deleteReport()">
                                            <i class="material-symbols-rounded text-sm">delete</i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="d-flex px-2 py-1">
                                            <div class="icon icon-shape icon-sm bg-gradient-warning shadow text-center me-2 d-flex align-items-center justify-content-center">
                                                <i class="material-symbols-rounded text-white opacity-10">description</i>
                                            </div>
                                            <div class="d-flex flex-column justify-content-center">
                                                <h6 class="mb-0 text-sm">Monthly Retention Analysis</h6>
                                                <p class="text-xs text-secondary mb-0">Customer loyalty metrics</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge badge-sm bg-gradient-primary">Retention</span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <span class="text-secondary text-xs">Dec 1 - Dec 31, 2024</span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <span class="text-secondary text-xs">Jan 1, 2025</span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <span class="badge badge-sm bg-gradient-info">Processing</span>
                                    </td>
                                    <td class="align-middle">
                                        <button class="btn btn-link text-secondary mb-0" disabled>
                                            <i class="material-symbols-rounded text-sm">visibility</i>
                                        </button>
                                        <button class="btn btn-link text-secondary mb-0" disabled>
                                            <i class="material-symbols-rounded text-sm">download</i>
                                        </button>
                                        <button class="btn btn-link text-secondary mb-0" disabled>
                                            <i class="material-symbols-rounded text-sm">share</i>
                                        </button>
                                        <button class="btn btn-link text-secondary mb-0" onclick="deleteReport()">
                                            <i class="material-symbols-rounded text-sm">delete</i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Generate Report Modal -->
<div class="modal fade" id="generateReportModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Generate New Report</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <div class="input-group input-group-outline">
                                <label class="form-label">Report Name</label>
                                <input type="text" class="form-control" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Report Type</label>
                            <select class="form-select" required>
                                <option value="">Select Report Type</option>
                                <option value="overview">Customer Overview</option>
                                <option value="behavior">Customer Behavior</option>
                                <option value="revenue">Revenue Analysis</option>
                                <option value="retention">Retention Report</option>
                                <option value="segmentation">Segmentation Report</option>
                                <option value="lifetime">Lifetime Value</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Time Period</label>
                            <select class="form-select" id="timePeriodSelect" required>
                                <option value="">Select Period</option>
                                <option value="last7">Last 7 Days</option>
                                <option value="last30">Last 30 Days</option>
                                <option value="last90">Last 90 Days</option>
                                <option value="thismonth">This Month</option>
                                <option value="lastmonth">Last Month</option>
                                <option value="thisquarter">This Quarter</option>
                                <option value="thisyear">This Year</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                    </div>
                    <div class="row" id="customDateRange" style="display: none;">
                        <div class="col-md-6 mb-3">
                            <div class="input-group input-group-outline">
                                <label class="form-label">Start Date</label>
                                <input type="date" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="input-group input-group-outline">
                                <label class="form-label">End Date</label>
                                <input type="date" class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Customer Segments (Optional)</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="vip" id="segVip">
                                <label class="form-check-label" for="segVip">VIP Customers</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="regular" id="segRegular">
                                <label class="form-check-label" for="segRegular">Regular Customers</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="new" id="segNew">
                                <label class="form-check-label" for="segNew">New Customers</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="inactive" id="segInactive">
                                <label class="form-check-label" for="segInactive">Inactive Customers</label>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Export Format</label>
                            <div class="btn-group w-100" role="group">
                                <input type="radio" class="btn-check" name="exportFormat" id="formatPdf" value="pdf" checked>
                                <label class="btn btn-outline-primary" for="formatPdf">PDF</label>

                                <input type="radio" class="btn-check" name="exportFormat" id="formatExcel" value="excel">
                                <label class="btn btn-outline-primary" for="formatExcel">Excel</label>

                                <input type="radio" class="btn-check" name="exportFormat" id="formatCsv" value="csv">
                                <label class="btn btn-outline-primary" for="formatCsv">CSV</label>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="emailReport">
                                <label class="form-check-label" for="emailReport">
                                    Email report when ready
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="scheduleReport">
                                <label class="form-check-label" for="scheduleReport">
                                    Schedule this report (recurring)
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn bg-gradient-primary" onclick="submitReport()">Generate Report</button>
            </div>
        </div>
    </div>
</div>
@section Script
{
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Customer Growth Chart
        const ctxGrowth = document.getElementById('customerGrowthChart').getContext('2d');
        new Chart(ctxGrowth, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                datasets: [{
                    label: 'New Customers',
                    data: [65, 78, 90, 81, 95, 105, 115, 120, 110, 130, 145, 155],
                    borderColor: '#17c1e8',
                    backgroundColor: 'rgba(23, 193, 232, 0.1)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'Returning Customers',
                    data: [45, 52, 60, 68, 75, 82, 90, 95, 100, 108, 115, 125],
                    borderColor: '#82d616',
                    backgroundColor: 'rgba(130, 214, 22, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Retention Chart
        const ctxRetention = document.getElementById('retentionChart').getContext('2d');
        new Chart(ctxRetention, {
            type: 'doughnut',
            data: {
                labels: ['Retained', 'Churned'],
                datasets: [{
                    data: [87, 13],
                    backgroundColor: ['#82d616', '#ea0606']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        function generateReport() {
            console.log('Generating report with filters...');
            alert('Applying filters and generating report...');
        }

        function viewReport() {
            console.log('Viewing report...');
            alert('Opening report viewer...');
        }

        function downloadReport() {
            console.log('Downloading report...');
            alert('Downloading report...');
        }

        function shareReport() {
            console.log('Sharing report...');
            alert('Share options opened');
        }

        function deleteReport() {
            if (confirm('Are you sure you want to delete this report?')) {
                console.log('Deleting report...');
                alert('Report deleted successfully!');
            }
        }

        function submitReport() {
            console.log('Submitting new report request...');
            alert('Report generation started! You will be notified when it\'s ready.');
            const modal = bootstrap.Modal.getInstance(document.getElementById('generateReportModal'));
            if (modal) modal.hide();
        }

        // Show/hide custom date range
        document.getElementById('timePeriodSelect').addEventListener('change', function(e) {
            const customRange = document.getElementById('customDateRange');
            if (e.target.value === 'custom') {
                customRange.style.display = 'flex';
            } else {
                customRange.style.display = 'none';
            }
        });
    </script>
}

