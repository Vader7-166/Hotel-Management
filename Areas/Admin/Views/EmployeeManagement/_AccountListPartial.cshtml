@model IEnumerable<Hotel_Management.Models.Account>

<div class="table-responsive">
    <table class="table table-flush" id="accounts-table">
        <thead class="thead-light">
            <tr>
                <th class="text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Username</th>
                <th class="text-uppercase text-secondary text-xs font-weight-bolder opacity-7 ps-2">Full Name</th>
                <th class="text-uppercase text-secondary text-xs font-weight-bolder opacity-7 ps-2">Email</th>
                <th class="text-uppercase text-secondary text-xs font-weight-bolder opacity-7 ps-2">Role</th>
                <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Action</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var account in Model)
            {
                <tr>
                    <td>
                        <h6 class="mb-0 text-sm px-2 py-1">@account.Username</h6>
                    </td>
                    <td>
                        <p class="text-sm font-weight-bold mb-0">@(account.Employee?.FullName ?? account.Customer?.FullName ?? "N/A")</p>
                    </td>
                    <td>
                        <p class="text-xs mb-0">@account.Email</p>
                    </td>
                    <td>
                        @if (account.Role == "Admin")
                        {
                            <span class="badge badge-sm bg-gradient-success">Admin</span>
                        }
                        else if (account.Role == "Employee")
                        {
                            <span class="badge badge-sm bg-gradient-info">Employee</span>
                        }
                        else if (account.Role == "Receptionist")
                        {
                            <span class="badge badge-sm bg-gradient-danger">Receptionist</span>
                        }
                    </td>
                    <td class="align-middle text-center">
                        @* Nút View *@
                        <a href="@Url.Action("Details", "EmployeeManagement", new { username = account.Username })" class="text-secondary font-weight-bold text-xs me-2 view-details-btn" data-bs-toggle="modal" data-bs-placement="top" title="View Details" data-bs-target="#detailsModal">
                            <i class="material-symbols-rounded">visibility</i>
                        </a>

                        @* Nút Edit *@
                        <a href="@Url.Action("Edit", "EmployeeManagement", new { username = account.Username })" class="text-secondary font-weight-bold text-xs me-2 edit-details-btn" data-bs-toggle="modal" data-bs-placement="top" title="Edit" data-bs-target="#detailsModal"">
                            <i class="material-symbols-rounded">edit</i>
                        </a>

                        @* Nút Delete (giữ nguyên href="#" vì logic JS dùng data-id) *@
                        <a href="#" data-id="@account.Username" data-name="@account.Username" class="text-secondary font-weight-bold text-xs delete-account-btn" title="Delete">
                            <i class="material-symbols-rounded">delete</i>
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>


<!-- Pagination -->
<div id="paginationContainer">
    <div class="border-top py-3 px-4">
        <div class="d-flex justify-content-between align-items-center">
            <p class="text-sm mb-0">Page <strong>@ViewBag.currentPage</strong> / <strong>@ViewBag.pageNum</strong></p>
            <nav aria-label="Page navigation">
                <ul class="pagination pagination-sm mb-0">
                    @{
                        int currentPage = ViewBag.currentPage ?? 1;
                        int pageNum = ViewBag.pageNum ?? 1;

                        // --- CÀI ĐẶT ---
                        // (neighbors = 1 
                        int neighbors = 1;

                        int maxButtons = (neighbors * 2) + 5;
                    }

                    <li class="page-item @(currentPage == 1 ? "disabled" : "")" page="@(currentPage - 1)">
                        <a class="page-link px-3" href="#">
                            <span aria-hidden="true">&lt;</span>
                        </a>
                    </li>

                    @if (pageNum <= maxButtons)
                    {
                        // TRƯỜNG HỢP 1: SỐ TRANG QUÁ ÍT (<= 7)
                        for (int i = 1; i <= pageNum; i++)
                        {
                            <li class="page-item @(i == currentPage ? "active" : "")" page="@i">
                                <a class="page-link" href="#">@i</a>
                            </li>
                        }
                    }
                    else
                    {
                        // TRƯỜNG HỢP 2: SỐ TRANG NHIỀU (> 7)
                        // có dấu "...".
                        for (int i = 1; i <= pageNum; i++)
                        {
                            // Xác định các "vùng" sẽ được hiển thị
                            bool isFirstPage = (i == 1);
                            bool isLastPage = (i == pageNum);
                            bool isNeighbor = (i >= currentPage - neighbors && i <= currentPage + neighbors);

                            // Xác định vị trí của dấu "..."
                            bool isLeftEllipsis = (i == currentPage - neighbors - 1);
                            bool isRightEllipsis = (i == currentPage + neighbors + 1);

                            if (isFirstPage || isLastPage || isNeighbor)
                            {
                                // HIỂN THỊ NÚT SỐ
                                <li class="page-item @(i == currentPage ? "active" : "")" page="@i">
                                    <a class="page-link" href="#">@i</a>
                                </li>
                            }
                            else if (isLeftEllipsis || isRightEllipsis)
                            {
                                // HIỂN THỊ DẤU "..."
                                <li class="page-item disabled">
                                    <a class="page-link" href="#">...</a>
                                </li>
                            }
                            // Các số khác (quá xa) sẽ bị ẩn đi
                        }
                    }

                    <li class="page-item @(currentPage == pageNum ? "disabled" : "")" page="@(currentPage + 1)">
                        <a class="page-link px-3" href="#">
                            <span aria-hidden="true">&gt;</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
